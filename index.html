<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binocular Rivalry WebXR Demo</title>
</head>
<body>
    <canvas id="xr-canvas"></canvas>
    <script>
        async function initializeWebXR() {
            const canvas = document.getElementById('xr-canvas');
            const gl = canvas.getContext('webgl', { xrCompatible: true });
            
            if (navigator.xr) {
                try {
                    const xrSession = await navigator.xr.requestSession('immersive-vr');
                    xrSession.updateRenderState({ baseLayer: new XRWebGLLayer(xrSession, gl) });

                    const referenceSpace = await xrSession.requestReferenceSpace('local');
                    const onXRFrame = (time, frame) => {
                        let session = frame.session;
                        const pose = frame.getViewerPose(referenceSpace);

                        gl.bindFramebuffer(gl.FRAMEBUFFER, xrSession.renderState.baseLayer.framebuffer);
                        gl.clearColor(0.8, 0.8, 0.8, 1.0);
                        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

                        if (pose) {
                            for (const view of pose.views) {
                                const viewport = xrSession.renderState.baseLayer.getViewport(view);
                                gl.viewport(viewport.x, viewport.y, viewport.width, viewport.height);

                                // Different rendering logic for each eye
                                if (view.eye === 'left') {
                                    // Render left eye view - e.g., a red circle
                                    renderLeftEye(gl);
                                } else if (view.eye === 'right') {
                                    // Render right eye view - e.g., a blue box
                                    renderRightEye(gl);
                                }
                            }
                        }

                        session.requestAnimationFrame(onXRFrame);
                    };

                    xrSession.requestAnimationFrame(onXRFrame);
                } catch (e) {
                    console.error("Failed to create immersive VR session", e);
                }
            } else {
                console.error("WebXR not supported");
            }
        }

        function renderLeftEye(gl) {
            // Placeholder rendering logic for left eye
            gl.clearColor(1.0, 0.0, 0.0, 1.0); // Red color for left eye
            gl.clear(gl.COLOR_BUFFER_BIT);
        }

        function renderRightEye(gl) {
            // Placeholder rendering logic for right eye
            gl.clearColor(0.0, 1.0, 1.0, 1.0); // Cyan color for right eye
            gl.clear(gl.COLOR_BUFFER_BIT);
        }

        initializeWebXR();
    </script>
</body>
</html>
